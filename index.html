<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FuelManager - Controle de Ve√≠culos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <style>
        /* SEU CSS COMPLETO AQUI (mantenha todo o estilo que voc√™ j√° tem) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', sans-serif;
        }
        
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --warning: #f72585;
            --danger: #e63946;
            --light: #f8f9fa;
            --dark: #2b2d42;
            --gray: #8d99ae;
            --background: #f5f7fa;
            --info: #7209b7;
        }
        
        body {
            background-color: var(--background);
            color: #333;
            min-height: 100vh;
            padding-bottom: 70px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 360px;
            margin: 0 auto;
            padding: 15px;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.08);
            position: relative;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            margin: -15px -15px 20px -15px;
            padding: 20px 15px;
            border-radius: 0 0 15px 15px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.3rem;
        }
        
        .logo i {
            font-size: 1.8rem;
        }
        
        .user-actions {
            display: flex;
            gap: 15px;
        }
        
        .user-actions i {
            font-size: 1.3rem;
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .user-actions i:hover {
            transform: scale(1.1);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.06);
            border: 1px solid #f0f0f0;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.09);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .vehicle-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            position: relative;
        }
        
        .vehicle-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            color: white;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }
        
        .vehicle-details h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .vehicle-details p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .stat-box {
            background: linear-gradient(to bottom right, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        }
        
        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: var(--gray);
            font-weight: 500;
        }
        
        .tank-level {
            margin: 20px 0;
        }
        
        .tank-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .tank-label {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--dark);
        }
        
        .tank-value {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .tank-bar {
            height: 12px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .tank-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 10px;
            width: 65%;
            transition: width 1s ease;
            box-shadow: 0 0 10px rgba(67, 97, 238, 0.4);
        }
        
        .autonomy-info {
            font-size: 0.8rem;
            color: var(--gray);
            text-align: right;
            margin-top: 5px;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 1px solid #eee;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #d90429);
            color: white;
            box-shadow: 0 4px 12px rgba(231, 57, 70, 0.3);
        }
        
        .btn-info {
            background: linear-gradient(135deg, var(--info), #560bad);
            color: white;
            box-shadow: 0 4px 12px rgba(114, 9, 183, 0.3);
        }
        
        .btn:hover {
            opacity: 0.92;
            transform: translateY(-2px);
        }
        
        .btn-primary:hover {
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.4);
        }
        
        .btn-danger:hover {
            box-shadow: 0 6px 15px rgba(231, 57, 70, 0.4);
        }
        
        .btn-info:hover {
            box-shadow: 0 6px 15px rgba(114, 9, 183, 0.4);
        }
        
        .list-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #f5f5f5;
            transition: background 0.2s;
        }
        
        .list-item:hover {
            background: #fafafa;
            border-radius: 8px;
            padding-left: 10px;
            padding-right: 10px;
        }
        
        .list-item:last-child {
            border-bottom: none;
        }
        
        .item-title {
            font-weight: 500;
            color: var(--dark);
        }
        
        .item-value {
            color: var(--dark);
            font-weight: 600;
        }
        
        .item-details {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 4px;
        }
        
        .nav-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.1);
            max-width: 360px;
            margin: 0 auto;
            z-index: 1000;
            border-radius: 20px 20px 0 0;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 15px;
            border-radius: 12px;
            color: var(--gray);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-item.active {
            color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
            transform: translateY(-5px);
        }
        
        .nav-item i {
            font-size: 1.3rem;
            margin-bottom: 4px;
            transition: transform 0.3s;
        }
        
        .nav-item.active i {
            transform: scale(1.15);
        }
        
        .nav-label {
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .chart-container {
            height: 220px;
            margin: 15px 0;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1001;
            transform: translateX(200%);
            transition: transform 0.4s ease;
            max-width: 300px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.95rem;
            color: var(--dark);
        }
        
        .form-input {
            width: 100%;
            padding: 14px;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.3s, box-shadow 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        textarea.form-input {
            min-height: 100px;
            resize: vertical;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 0;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.7;
        }
        
        .empty-state p {
            margin-top: 12px;
            font-size: 1.1rem;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .badge-success {
            background: rgba(76, 201, 240, 0.15);
            color: var(--success);
        }
        
        .badge-warning {
            background: rgba(247, 37, 133, 0.15);
            color: var(--warning);
        }
        
        .badge-info {
            background: rgba(114, 9, 183, 0.15);
            color: var(--info);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1002;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 25px;
            width: 320px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            transform: scale(0.9);
            animation: zoomIn 0.3s forwards;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        @keyframes zoomIn {
            to {
                transform: scale(1);
            }
        }
        
        .welcome-message {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
            color: var(--dark);
            font-weight: 500;
        }
        
        .consumption-comparison {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 10px;
        }
        
        .comparison-label {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .comparison-value {
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .positive {
            color: #2ecc71;
        }
        
        .negative {
            color: #e74c3c;
        }
        
        .delete-btn {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(231, 57, 70, 0.1);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--danger);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .delete-btn:hover {
            background: var(--danger);
            color: white;
        }
        
        .vehicle-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .vehicle-type {
            flex: 1;
            text-align: center;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .vehicle-type.active {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
        }
        
        .vehicle-type i {
            font-size: 1.5rem;
            margin-bottom: 5px;
            color: var(--primary);
        }
        
        .vehicle-type.active i {
            color: var(--primary);
        }
        
        .km-update-form {
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .fuel-price-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .fuel-price-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .fuel-price-title {
            font-weight: 600;
            color: var(--dark);
        }
        
        .fuel-price-value {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .maintenance-status {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-overdue {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .maintenance-item {
            position: relative;
        }
        
        .maintenance-details {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 4px;
            line-height: 1.4;
        }
        
        .maintenance-km {
            font-size: 0.8rem;
            color: var(--info);
            font-weight: 600;
            margin-top: 4px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-gas-pump"></i>
                <span>FuelManager</span>
            </div>
            <div class="user-actions">
                <i class="fas fa-bell" onclick="toggleNotifications()"></i>
                <i class="fas fa-cog" onclick="showSettings()"></i>
            </div>
        </header>
        
        <div id="dashboard" class="tab-content active">
            <div class="fuel-price-section">
                <div class="fuel-price-header">
                    <div class="fuel-price-title">Pre√ßo da Gasolina</div>
                    <div class="fuel-price-value" id="currentFuelPrice">R$ 5,89/L</div>
                </div>
                <button class="btn btn-secondary" onclick="showFuelPriceModal()" style="width: 100%;">
                    <i class="fas fa-edit"></i> Alterar Pre√ßo
                </button>
            </div>
            
            <div class="card">
                <div class="vehicle-info">
                    <div class="vehicle-icon" id="currentVehicleIcon">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="vehicle-details">
                        <h3 id="currentVehicleName">Selecione um ve√≠culo</h3>
                        <p id="currentVehicleDetails">Nenhum ve√≠culo cadastrado</p>
                    </div>
                </div>
                
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-value" id="currentEfficiency">--</div>
                        <div class="stat-label">km/L</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="currentKm">--</div>
                        <div class="stat-label">KM TOTAL</div>
                    </div>
                </div>
                
                <div class="tank-level">
                    <div class="tank-header">
                        <span class="tank-label">N√≠vel do Tanque</span>
                        <span class="tank-value" id="currentTankLevel">--%</span>
                    </div>
                    <div class="tank-bar">
                        <div class="tank-fill" id="currentTankFill"></div>
                    </div>
                    <div class="autonomy-info" id="autonomyInfo">
                        Autonomia: -- km
                    </div>
                </div>
                
                <div class="consumption-comparison" id="consumptionComparison">
                    <span class="comparison-label">Vs. √∫ltimo m√™s</span>
                    <span class="comparison-value">--</span>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Consumo Mensal</div>
                    <i class="fas fa-chart-line" style="color: var(--primary);"></i>
                </div>
                <div class="chart-container">
                    <canvas id="consumptionChart"></canvas>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">√öltimo Abastecimento</div>
                    <i class="fas fa-history" style="color: var(--primary);"></i>
                </div>
                
                <div class="list-item" id="lastRefuelItem">
                    <div>
                        <div class="item-title">Nenhum abastecimento</div>
                        <div class="item-details">Registre seu primeiro abastecimento</div>
                    </div>
                    <div class="item-value">--</div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="showTab('abastecimento')">
                        <i class="fas fa-gas-pump"></i> Abastecer
                    </button>
                    <button class="btn btn-primary" onclick="showUpdateKmModal()">
                        <i class="fas fa-sync-alt"></i> Atualizar KM
                    </button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Pr√≥ximas Manuten√ß√µes</div>
                    <i class="fas fa-tools" style="color: var(--info);"></i>
                </div>
                
                <div id="upcomingMaintenanceList">
                    <div class="empty-state">
                        <i class="fas fa-tools"></i>
                        <p>Nenhuma manuten√ß√£o agendada</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="veiculos" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Meus Ve√≠culos</div>
                    <i class="fas fa-plus" style="color: var(--primary); cursor: pointer;" onclick="showAddVehicleModal()"></i>
                </div>
                
                <div id="vehiclesList">
                    <div class="empty-state">
                        <i class="fas fa-car"></i>
                        <h3>Nenhum ve√≠culo cadastrado</h3>
                        <p>Adicione seu primeiro ve√≠culo para come√ßar</p>
                    </div>
                </div>
            </div>
            
            <div class="card stats-card">
                <div class="card-header">
                    <div class="card-title">Estat√≠sticas</div>
                    <i class="fas fa-chart-pie" style="color: var(--primary);"></i>
                </div>
                
                <div class="list-item">
                    <div class="item-title">Gasto Mensal</div>
                    <div class="item-value" id="monthlyExpense">R$ 0,00</div>
                </div>
                
                <div class="list-item">
                    <div class="item-title">Quilometragem Mensal</div>
                    <div class="item-value" id="monthlyKm">0 km</div>
                </div>
                
                <div class="list-item">
                    <div class="item-title">Custo por KM</div>
                    <div class="item-value" id="costPerKm">R$ 0,00</div>
                </div>
            </div>
        </div>
        
        <div id="abastecimento" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Registrar Abastecimento</div>
                    <i class="fas fa-gas-pump" style="color: var(--primary);"></i>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ve√≠culo</label>
                    <select class="form-input" id="refuelVehicle">
                        <option value="">Selecione um ve√≠culo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Data</label>
                    <input type="date" class="form-input" id="refuelDate">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Posto</label>
                    <input type="text" class="form-input" id="refuelStation" placeholder="Nome do posto">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Pre√ßo por Litro (R$)</label>
                    <input type="number" step="0.01" class="form-input" id="refuelPrice" placeholder="5,89" value="5.89">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Valor Total (R$)</label>
                    <input type="number" step="0.01" class="form-input" id="refuelAmount" placeholder="280,00" oninput="calculateLiters()">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Litros Abastecidos</label>
                    <input type="number" step="0.01" class="form-input" id="refuelLiters" placeholder="Calculado automaticamente" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Quilometragem Atual</label>
                    <input type="number" class="form-input" id="refuelKm" placeholder="45290">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Tanque completo?</label>
                    <select class="form-input" id="refuelFullTank">
                        <option value="true">Sim</option>
                        <option value="false">N√£o</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" style="width: 100%;" onclick="addRefuel()">
                    <i class="fas fa-save"></i> Salvar Abastecimento
                </button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Hist√≥rico Recente</div>
                    <i class="fas fa-history" style="color: var(--primary);"></i>
                </div>
                
                <div id="refuelHistoryList">
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <p>Nenhum abastecimento registrado</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="manutencoes" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Nova Manuten√ß√£o</div>
                    <i class="fas fa-tools" style="color: var(--info);"></i>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ve√≠culo</label>
                    <select class="form-input" id="maintenanceVehicle">
                        <option value="">Selecione um ve√≠culo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nome da Manuten√ß√£o</label>
                    <input type="text" class="form-input" id="maintenanceName" placeholder="Ex: Troca de √≥leo, Alinhamento, Freios">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o (opcional)</label>
                    <textarea class="form-input" id="maintenanceDescription" placeholder="Detalhes sobre o que foi feito..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Data da Manuten√ß√£o</label>
                    <input type="date" class="form-input" id="maintenanceDate">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Quilometragem na Manuten√ß√£o</label>
                    <input type="number" class="form-input" id="maintenanceKm" placeholder="KM atual do ve√≠culo">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Repetir a cada (KM)</label>
                    <input type="number" class="form-input" id="maintenanceRepeatKm" placeholder="Ex: 10000 (repetir a cada 10.000 km)">
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="maintenanceCompleted">
                    <label for="maintenanceCompleted">Manuten√ß√£o j√° realizada</label>
                </div>
                
                <button class="btn btn-info" style="width: 100%;" onclick="addMaintenance()">
                    <i class="fas fa-plus"></i> Adicionar Manuten√ß√£o
                </button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Hist√≥rico de Manuten√ß√µes</div>
                    <i class="fas fa-history" style="color: var(--info);"></i>
                </div>
                
                <div id="maintenanceHistoryList">
                    <div class="empty-state">
                        <i class="fas fa-tools"></i>
                        <p>Nenhuma manuten√ß√£o registrada</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Pr√≥ximas Manuten√ß√µes</div>
                    <i class="fas fa-calendar-alt" style="color: var(--info);"></i>
                </div>
                
                <div id="maintenanceUpcomingList">
                    <div class="empty-state">
                        <i class="fas fa-calendar-check"></i>
                        <p>Nenhuma manuten√ß√£o agendada</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="nav-bottom">
            <div class="nav-item active" onclick="showTab('dashboard')">
                <i class="fas fa-home"></i>
                <span class="nav-label">Dashboard</span>
            </div>
            <div class="nav-item" onclick="showTab('veiculos')">
                <i class="fas fa-car"></i>
                <span class="nav-label">Ve√≠culos</span>
            </div>
            <div class="nav-item" onclick="showTab('abastecimento')">
                <i class="fas fa-gas-pump"></i>
                <span class="nav-label">Abastecimento</span>
            </div>
            <div class="nav-item" onclick="showTab('manutencoes')">
                <i class="fas fa-tools"></i>
                <span class="nav-label">Manuten√ß√µes</span>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Opera√ß√£o realizada com sucesso!</span>
    </div>

    <div class="modal" id="addVehicleModal">
        <div class="modal-content">
            <div class="card-header">
                <div class="card-title">Adicionar Ve√≠culo</div>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeModal('addVehicleModal')"></i>
            </div>
            
            <div class="vehicle-type-selector">
                <div class="vehicle-type active" data-type="car" onclick="selectVehicleType('car')">
                    <i class="fas fa-car"></i>
                    <div>Carro</div>
                </div>
                <div class="vehicle-type" data-type="motorcycle" onclick="selectVehicleType('motorcycle')">
                    <i class="fas fa-motorcycle"></i>
                    <div>Moto</div>
                </div>
                <div class="vehicle-type" data-type="truck" onclick="selectVehicleType('truck')">
                    <i class="fas fa-truck"></i>
                    <div>Caminh√£o</div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Modelo do Ve√≠culo</label>
                <input type="text" class="form-input" id="vehicleModel" placeholder="Ex: Hyundai HB20">
            </div>
            
            <div class="form-group">
                <label class="form-label">Placa</label>
                <input type="text" class="form-input" id="vehiclePlate" placeholder="Ex: ABC-1234">
            </div>
            
            <div class="form-group">
                <label class="form-label">Ano</label>
                <input type="number" class="form-input" id="vehicleYear" placeholder="Ex: 2022">
            </div>
            
            <div class="form-group">
                <label class="form-label">Quilometragem Atual</label>
                <input type="number" class="form-input" id="vehicleKm" placeholder="Ex: 45290">
            </div>
            
            <div class="form-group">
                <label class="form-label">Capacidade do Tanque (L)</label>
                <input type="number" class="form-input" id="vehicleTankCapacity" placeholder="Ex: 50">
            </div>
            
            <button class="btn btn-primary" style="width: 100%;" onclick="addVehicle()">
                <i class="fas fa-plus"></i> Adicionar Ve√≠culo
            </button>
        </div>
    </div>

    <div class="modal" id="updateKmModal">
        <div class="modal-content">
            <div class="card-header">
                <div class="card-title">Atualizar Quilometragem</div>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeModal('updateKmModal')"></i>
            </div>
            
            <div class="welcome-message">
                Atualize a quilometragem do <span id="updateKmVehicleName">ve√≠culo</span>
            </div>
            
            <div class="form-group">
                <label class="form-label">Quilometragem Atual</label>
                <input type="number" class="form-input" id="updateKmValue" placeholder="Digite a nova quilometragem">
            </div>
            
            <div class="km-update-form">
                <p><strong>KM anterior:</strong> <span id="previousKm">--</span></p>
                <p><strong>KM percorridos:</strong> <span id="kmDriven">--</span></p>
                <p><strong>N√≠vel do tanque atual:</strong> <span id="currentTankBeforeUpdate">--%</span></p>
                <p><strong>Novo n√≠vel estimado:</strong> <span id="estimatedTankAfterUpdate">--%</span></p>
            </div>
            
            <button class="btn btn-primary" style="width: 100%;" onclick="updateKm()">
                <i class="fas fa-sync-alt"></i> Atualizar Quilometragem
            </button>
        </div>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="card-header">
                <div class="card-title">Configura√ß√µes</div>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeModal('settingsModal')"></i>
            </div>
            <div class="welcome-message">
                Ol√°, Usu√°rio! üëã
            </div>
            <div class="form-group">
                <label class="form-label">Notifica√ß√µes</label>
                <select class="form-input" id="notificationSettings">
                    <option value="true">Ativadas</option>
                    <option value="false">Desativadas</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Tipo de combust√≠vel padr√£o</label>
                <select class="form-input" id="defaultFuelType">
                    <option>Gasolina</option>
                    <option>Etanol</option>
                    <option>Diesel</option>
                    <option>Flex</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Limpar todos os dados</label>
                <button class="btn btn-danger" style="width: 100%;" onclick="clearAllData()">
                    <i class="fas fa-trash"></i> Limpar Dados
                </button>
            </div>
            <button class="btn btn-primary" style="width: 100%;" onclick="saveSettings()">
                Salvar Configura√ß√µes
            </button>
        </div>
    </div>

    <div class="modal" id="fuelPriceModal">
        <div class="modal-content">
            <div class="card-header">
                <div class="card-title">Alterar Pre√ßo da Gasolina</div>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeModal('fuelPriceModal')"></i>
            </div>
            
            <div class="welcome-message">
                Defina o pre√ßo atual da gasolina
            </div>
            
            <div class="form-group">
                <label class="form-label">Pre√ßo por Litro (R$)</label>
                <input type="number" step="0.01" class="form-input" id="newFuelPrice" placeholder="5,89">
            </div>
            
            <button class="btn btn-primary" style="width: 100%;" onclick="updateFuelPrice()">
                <i class="fas fa-save"></i> Atualizar Pre√ßo
            </button>
        </div>
    </div>

    <div class="modal" id="editMaintenanceModal">
        <div class="modal-content">
            <div class="card-header">
                <div class="card-title">Editar Manuten√ß√£o</div>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeModal('editMaintenanceModal')"></i>
            </div>
            
            <div class="form-group">
                <label class="form-label">Nome da Manuten√ß√£o</label>
                <input type="text" class="form-input" id="editMaintenanceName">
            </div>
            
            <div class="form-group">
                <label class="form-label">Descri√ß√£o</label>
                <textarea class="form-input" id="editMaintenanceDescription"></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Data</label>
                <input type="date" class="form-input" id="editMaintenanceDate">
            </div>
            
            <div class="form-group">
                <label class="form-label">Quilometragem</label>
                <input type="number" class="form-input" id="editMaintenanceKm">
            </div>
            
            <div class="form-group">
                <label class="form-label">Repetir a cada (KM)</label>
                <input type="number" class="form-input" id="editMaintenanceRepeatKm">
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="editMaintenanceCompleted">
                <label for="editMaintenanceCompleted">Manuten√ß√£o realizada</label>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-info" onclick="saveEditedMaintenance()">
                    <i class="fas fa-save"></i> Salvar
                </button>
                <button class="btn btn-danger" onclick="deleteMaintenance()">
                    <i class="fas fa-trash"></i> Excluir
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√£o do Firebase para Realtime Database
        const firebaseConfig = {
            apiKey: "AIzaSyAx529m4KDCWW2Jiea38jTtRf8EhZnaAME",
            authDomain: "manager-fuel.firebaseapp.com",
            databaseURL: "https://manager-fuel-default-rtdb.firebaseio.com",
            projectId: "manager-fuel",
            storageBucket: "manager-fuel.firebasestorage.app",
            messagingSenderId: "919016829612",
            appId: "1:919016829612:web:773e59a5646f8814642509",
            measurementId: "G-LWJFG2B9VT"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // Dados da aplica√ß√£o
        let vehicles = [];
        let refuels = [];
        let maintenances = [];
        let settings = {};
        let selectedVehicleType = 'car';
        let currentVehicle = null;
        let editingMaintenanceId = null;
        let currentUserId = null;

        // Inicializa√ß√£o quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', async function() {
            await initApp();
        });
        
        // Inicializar aplicativo com Firebase Realtime Database
        async function initApp() {
            try {
                console.log('üöÄ Iniciando FuelManager com Realtime Database...');
                
                // Configurar data atual
                const today = new Date();
                const formattedDate = today.toISOString().substr(0, 10);
                document.getElementById('refuelDate').value = formattedDate;
                document.getElementById('maintenanceDate').value = formattedDate;
                
                // Inicializar autentica√ß√£o
                await initAuth();
                
                // Carregar configura√ß√µes
                await loadSettings();
                
                // Carregar dados
                await loadVehicles();
                await loadRefuels();
                await loadMaintenances();
                
                // Atualizar estat√≠sticas
                updateStatistics();
                
                // Inicializar gr√°ficos se houver ve√≠culos
                if (vehicles.length > 0) {
                    initCharts();
                    selectVehicle(vehicles[0].id);
                } else {
                    updateDashboard();
                }
                
                showNotification('Aplicativo carregado com sucesso!');
            } catch (error) {
                console.error('Erro na inicializa√ß√£o:', error);
                showNotification('Erro ao carregar dados. Usando modo offline.');
                loadFromLocalStorage();
            }
        }
        
        // Inicializar autentica√ß√£o
        async function initAuth() {
            return new Promise((resolve, reject) => {
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        console.log('‚úÖ Usu√°rio autenticado:', user.uid);
                        resolve();
                    } else {
                        try {
                            console.log('üîÑ Criando usu√°rio an√¥nimo...');
                            const result = await auth.signInAnonymously();
                            currentUserId = result.user.uid;
                            console.log('‚úÖ Usu√°rio an√¥nimo criado:', currentUserId);
                            resolve();
                        } catch (error) {
                            console.error('‚ùå Erro na autentica√ß√£o:', error);
                            console.log('‚ö†Ô∏è Usando modo offline');
                            resolve();
                        }
                    }
                });
            });
        }
        
        // Carregar do localStorage (fallback)
        function loadFromLocalStorage() {
            vehicles = JSON.parse(localStorage.getItem('vehicles')) || [];
            refuels = JSON.parse(localStorage.getItem('refuels')) || [];
            maintenances = JSON.parse(localStorage.getItem('maintenances')) || [];
            settings = JSON.parse(localStorage.getItem('fuelmanager_settings')) || {
                notifications: true,
                defaultFuelType: 'Gasolina',
                fuelPrice: 5.89
            };
            
            loadVehicles();
            loadRefuels();
            loadMaintenances();
            updateDashboard();
        }
        
        // FUN√á√ïES DO REALTIME DATABASE
        
        // Salvar ve√≠culo no Realtime Database
        async function saveVehicleToDatabase(vehicle) {
            try {
                if (!currentUserId) {
                    console.log('‚ö†Ô∏è Sem usu√°rio, salvando apenas localmente');
                    return;
                }
                
                console.log('üíæ Salvando ve√≠culo no Firebase:', vehicle.id);
                
                await database.ref(`users/${currentUserId}/vehicles/${vehicle.id}`).set({
                    ...vehicle,
                    createdAt: Date.now()
                });
                
                console.log('‚úÖ Ve√≠culo salvo no Firebase');
            } catch (error) {
                console.error('‚ùå Erro ao salvar ve√≠culo no Firebase:', error);
                throw error;
            }
        }
        
        // Salvar abastecimento no Realtime Database
        async function saveRefuelToDatabase(refuel) {
            try {
                if (!currentUserId) {
                    console.log('‚ö†Ô∏è Sem usu√°rio, salvando apenas localmente');
                    return;
                }
                
                console.log('üíæ Salvando abastecimento no Firebase:', refuel.id);
                
                await database.ref(`users/${currentUserId}/refuels/${refuel.id}`).set({
                    ...refuel,
                    createdAt: Date.now()
                });
                
                console.log('‚úÖ Abastecimento salvo no Firebase');
            } catch (error) {
                console.error('‚ùå Erro ao salvar abastecimento no Firebase:', error);
                throw error;
            }
        }
        
        // Salvar manuten√ß√£o no Realtime Database
        async function saveMaintenanceToDatabase(maintenance) {
            try {
                if (!currentUserId) {
                    console.log('‚ö†Ô∏è Sem usu√°rio, salvando apenas localmente');
                    return;
                }
                
                console.log('üíæ Salvando manuten√ß√£o no Firebase:', maintenance.id);
                
                await database.ref(`users/${currentUserId}/maintenances/${maintenance.id}`).set({
                    ...maintenance,
                    createdAt: Date.now()
                });
                
                console.log('‚úÖ Manuten√ß√£o salva no Firebase');
            } catch (error) {
                console.error('‚ùå Erro ao salvar manuten√ß√£o no Firebase:', error);
                throw error;
            }
        }
        
        // Carregar configura√ß√µes
        async function loadSettings() {
            try {
                if (currentUserId) {
                    const snapshot = await database.ref(`users/${currentUserId}/settings`).once('value');
                    if (snapshot.exists()) {
                        settings = snapshot.val();
                    } else {
                        settings = {
                            notifications: true,
                            defaultFuelType: 'Gasolina',
                            fuelPrice: 5.89
                        };
                    }
                } else {
                    settings = JSON.parse(localStorage.getItem('fuelmanager_settings')) || {
                        notifications: true,
                        defaultFuelType: 'Gasolina',
                        fuelPrice: 5.89
                    };
                }
                
                document.getElementById('notificationSettings').value = settings.notifications;
                document.getElementById('defaultFuelType').value = settings.defaultFuelType;
                document.getElementById('refuelPrice').value = settings.fuelPrice;
                document.getElementById('currentFuelPrice').textContent = `R$ ${settings.fuelPrice.toFixed(2)}/L`;
            } catch (error) {
                console.error('Erro ao carregar configura√ß√µes:', error);
            }
        }
        
        // Fun√ß√£o para salvar configura√ß√µes
        async function saveSettings() {
            try {
                settings.notifications = document.getElementById('notificationSettings').value === 'true';
                settings.defaultFuelType = document.getElementById('defaultFuelType').value;
                
                if (currentUserId) {
                    await database.ref(`users/${currentUserId}/settings`).set(settings);
                }
                
                localStorage.setItem('fuelmanager_settings', JSON.stringify(settings));
                closeModal('settingsModal');
                showNotification('Configura√ß√µes salvas com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar configura√ß√µes:', error);
                showNotification('Erro ao salvar configura√ß√µes.');
            }
        }
        
        // Fun√ß√£o para limpar todos os dados
        async function clearAllData() {
            if (!confirm('Tem certeza que deseja apagar TODOS os dados? Esta a√ß√£o n√£o pode ser desfeita.')) {
                return;
            }
            
            try {
                vehicles = [];
                refuels = [];
                maintenances = [];
                currentVehicle = null;
                
                if (currentUserId) {
                    // Limpar dados do Realtime Database
                    await database.ref(`users/${currentUserId}`).remove();
                }
                
                localStorage.removeItem('vehicles');
                localStorage.removeItem('refuels');
                localStorage.removeItem('maintenances');
                
                loadVehicles();
                loadRefuels();
                loadMaintenances();
                updateDashboard();
                updateStatistics();
                
                showNotification('Todos os dados foram removidos.');
                closeModal('settingsModal');
            } catch (error) {
                console.error('Erro ao limpar dados:', error);
                showNotification('Erro ao limpar dados.');
            }
        }
        
        // Fun√ß√£o para carregar ve√≠culos
        async function loadVehicles() {
            try {
                if (currentUserId) {
                    const snapshot = await database.ref(`users/${currentUserId}/vehicles`).once('value');
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        vehicles = Object.keys(data).map(key => ({
                            id: key,
                            ...data[key]
                        }));
                        
                        localStorage.setItem('vehicles', JSON.stringify(vehicles));
                    }
                }
                
                const vehiclesList = document.getElementById('vehiclesList');
                const refuelVehicleSelect = document.getElementById('refuelVehicle');
                const maintenanceVehicleSelect = document.getElementById('maintenanceVehicle');
                
                vehiclesList.innerHTML = '';
                refuelVehicleSelect.innerHTML = '<option value="">Selecione um ve√≠culo</option>';
                maintenanceVehicleSelect.innerHTML = '<option value="">Selecione um ve√≠culo</option>';
                
                if (vehicles.length === 0) {
                    vehiclesList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-car"></i>
                            <h3>Nenhum ve√≠culo cadastrado</h3>
                            <p>Adicione seu primeiro ve√≠culo para come√ßar</p>
                        </div>
                    `;
                    return;
                }
                
                vehicles.forEach(vehicle => {
                    const vehicleElement = document.createElement('div');
                    vehicleElement.className = 'vehicle-info';
                    vehicleElement.style.cursor = 'pointer';
                    vehicleElement.style.marginBottom = '15px';
                    vehicleElement.onclick = () => selectVehicle(vehicle.id);
                    
                    const iconClass = vehicle.type === 'car' ? 'car' : 
                                     vehicle.type === 'motorcycle' ? 'motorcycle' : 'truck';
                    
                    vehicleElement.innerHTML = `
                        <div class="vehicle-icon">
                            <i class="fas fa-${iconClass}"></i>
                        </div>
                        <div class="vehicle-details">
                            <h3>${vehicle.model}</h3>
                            <p>${vehicle.plate} ‚Ä¢ ${vehicle.year}</p>
                        </div>
                        <div class="delete-btn" onclick="event.stopPropagation(); deleteVehicle('${vehicle.id}')">
                            <i class="fas fa-trash"></i>
                        </div>
                    `;
                    
                    vehiclesList.appendChild(vehicleElement);
                    
                    const option1 = document.createElement('option');
                    option1.value = vehicle.id;
                    option1.textContent = `${vehicle.model} (${vehicle.plate})`;
                    refuelVehicleSelect.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = vehicle.id;
                    option2.textContent = `${vehicle.model} (${vehicle.plate})`;
                    maintenanceVehicleSelect.appendChild(option2);
                });
            } catch (error) {
                console.error('Erro ao carregar ve√≠culos:', error);
                loadFromLocalStorage();
            }
        }
        
        // Fun√ß√£o para carregar abastecimentos
        async function loadRefuels() {
            try {
                if (currentUserId) {
                    const snapshot = await database.ref(`users/${currentUserId}/refuels`).once('value');
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        refuels = Object.keys(data).map(key => ({
                            id: key,
                            ...data[key]
                        }));
                        
                        localStorage.setItem('refuels', JSON.stringify(refuels));
                    }
                }
                
                const refuelHistoryList = document.getElementById('refuelHistoryList');
                refuelHistoryList.innerHTML = '';
                
                if (refuels.length === 0) {
                    refuelHistoryList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <p>Nenhum abastecimento registrado</p>
                        </div>
                    `;
                    return;
                }
                
                const recentRefuels = [...refuels].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
                
                recentRefuels.forEach(refuel => {
                    const vehicle = vehicles.find(v => v.id === refuel.vehicleId);
                    const vehicleName = vehicle ? `${vehicle.model} (${vehicle.plate})` : 'Ve√≠culo n√£o encontrado';
                    
                    const refuelElement = document.createElement('div');
                    refuelElement.className = 'list-item';
                    
                    refuelElement.innerHTML = `
                        <div>
                            <div class="item-title">${vehicleName}</div>
                            <div class="item-details">${formatDate(refuel.date)} ‚Ä¢ ${refuel.station || 'Posto n√£o informado'}</div>
                        </div>
                        <div class="item-value">R$ ${refuel.amount.toFixed(2)}</div>
                    `;
                    
                    refuelHistoryList.appendChild(refuelElement);
                });
            } catch (error) {
                console.error('Erro ao carregar abastecimentos:', error);
                loadFromLocalStorage();
            }
        }
        
        // Fun√ß√£o para carregar manuten√ß√µes
        async function loadMaintenances() {
            try {
                if (currentUserId) {
                    const snapshot = await database.ref(`users/${currentUserId}/maintenances`).once('value');
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        maintenances = Object.keys(data).map(key => ({
                            id: key,
                            ...data[key]
                        }));
                        
                        localStorage.setItem('maintenances', JSON.stringify(maintenances));
                    }
                }
                
                const maintenanceHistoryList = document.getElementById('maintenanceHistoryList');
                const maintenanceUpcomingList = document.getElementById('maintenanceUpcomingList');
                const dashboardUpcomingList = document.getElementById('upcomingMaintenanceList');
                
                maintenanceHistoryList.innerHTML = '';
                maintenanceUpcomingList.innerHTML = '';
                dashboardUpcomingList.innerHTML = '';
                
                if (maintenances.length === 0) {
                    maintenanceHistoryList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-tools"></i>
                            <p>Nenhuma manuten√ß√£o registrada</p>
                        </div>
                    `;
                    maintenanceUpcomingList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-calendar-check"></i>
                            <p>Nenhuma manuten√ß√£o agendada</p>
                        </div>
                    `;
                    dashboardUpcomingList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-tools"></i>
                            <p>Nenhuma manuten√ß√£o agendada</p>
                        </div>
                    `;
                    return;
                }
                
                const completedMaintenances = [];
                const upcomingMaintenances = [];
                const overdueMaintenances = [];
                
                maintenances.forEach(maintenance => {
                    const vehicle = vehicles.find(v => v.id === maintenance.vehicleId);
                    if (!vehicle) return;
                    
                    if (maintenance.completed) {
                        completedMaintenances.push({...maintenance, vehicle});
                    } else {
                        const nextKm = maintenance.lastKm + maintenance.repeatKm;
                        const isOverdue = vehicle.km >= nextKm;
                        
                        if (isOverdue) {
                            overdueMaintenances.push({...maintenance, vehicle, nextKm});
                        } else {
                            upcomingMaintenances.push({...maintenance, vehicle, nextKm});
                        }
                    }
                });
                
                upcomingMaintenances.sort((a, b) => a.nextKm - b.nextKm);
                overdueMaintenances.sort((a, b) => a.nextKm - b.nextKm);
                
                displayUpcomingMaintenances(dashboardUpcomingList, [...overdueMaintenances, ...upcomingMaintenances]);
                
                if (completedMaintenances.length === 0) {
                    maintenanceHistoryList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-tools"></i>
                            <p>Nenhuma manuten√ß√£o conclu√≠da</p>
                        </div>
                    `;
                } else {
                    completedMaintenances.slice(0, 5).forEach(maintenance => {
                        const element = createMaintenanceElement(maintenance, true);
                        maintenanceHistoryList.appendChild(element);
                    });
                }
                
                if (upcomingMaintenances.length === 0 && overdueMaintenances.length === 0) {
                    maintenanceUpcomingList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-calendar-check"></i>
                            <p>Nenhuma manuten√ß√£o agendada</p>
                        </div>
                    `;
                } else {
                    overdueMaintenances.forEach(maintenance => {
                        const element = createMaintenanceElement(maintenance, false);
                        maintenanceUpcomingList.appendChild(element);
                    });
                    
                    upcomingMaintenances.forEach(maintenance => {
                        const element = createMaintenanceElement(maintenance, false);
                        maintenanceUpcomingList.appendChild(element);
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar manuten√ß√µes:', error);
                loadFromLocalStorage();
            }
        }
        
        // Fun√ß√£o para criar elemento de manuten√ß√£o
        function createMaintenanceElement(maintenance, isCompleted) {
            const element = document.createElement('div');
            element.className = 'list-item maintenance-item';
            element.onclick = () => editMaintenance(maintenance.id);
            
            const status = isCompleted ? 'completed' : 
                          (maintenance.nextKm && maintenance.vehicle.km >= maintenance.nextKm) ? 'overdue' : 'pending';
            
            const statusText = isCompleted ? 'Conclu√≠da' : 
                             (maintenance.nextKm && maintenance.vehicle.km >= maintenance.nextKm) ? 'Vencida' : 'Pendente';
            
            const statusClass = isCompleted ? 'status-completed' : 
                              (maintenance.nextKm && maintenance.vehicle.km >= maintenance.nextKm) ? 'status-overdue' : 'status-pending';
            
            const kmInfo = isCompleted ? 
                `Feita em: ${maintenance.lastKm.toLocaleString('pt-BR')} km` :
                `Pr√≥xima em: ${maintenance.nextKm.toLocaleString('pt-BR')} km (faltam ${(maintenance.nextKm - maintenance.vehicle.km).toLocaleString('pt-BR')} km)`;
            
            element.innerHTML = `
                <div style="flex: 1;">
                    <div class="item-title">${maintenance.name}
                        <span class="maintenance-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="maintenance-details">${maintenance.description || 'Sem descri√ß√£o'}</div>
                    <div class="maintenance-details">Ve√≠culo: ${maintenance.vehicle.model} (${maintenance.vehicle.plate})</div>
                    <div class="maintenance-km">${kmInfo}</div>
                </div>
            `;
            
            return element;
        }
        
        // Fun√ß√£o para exibir manuten√ß√µes pendentes na dashboard
        function displayUpcomingMaintenances(container, maintenances) {
            if (maintenances.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tools"></i>
                        <p>Nenhuma manuten√ß√£o agendada</p>
                    </div>
                `;
                return;
            }
            
            const limitedMaintenances = maintenances.slice(0, 3);
            
            limitedMaintenances.forEach(maintenance => {
                const element = document.createElement('div');
                element.className = 'list-item';
                element.onclick = () => {
                    selectVehicle(maintenance.vehicleId);
                    showTab('manutencoes');
                };
                
                const isOverdue = maintenance.vehicle.km >= maintenance.nextKm;
                const statusClass = isOverdue ? 'status-overdue' : 'status-pending';
                const statusText = isOverdue ? 'VENCIDA' : 'PENDENTE';
                const kmLeft = maintenance.nextKm - maintenance.vehicle.km;
                
                element.innerHTML = `
                    <div>
                        <div class="item-title">${maintenance.name}
                            <span class="maintenance-status ${statusClass}">${statusText}</span>
                        </div>
                        <div class="item-details">${maintenance.vehicle.model}</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="item-value">${maintenance.nextKm.toLocaleString('pt-BR')} km</div>
                        <div class="item-details">${kmLeft > 0 ? `Faltam ${kmLeft.toLocaleString('pt-BR')} km` : 'Vencida!'}</div>
                    </div>
                `;
                
                container.appendChild(element);
            });
        }
        
        // Fun√ß√£o para adicionar ve√≠culo
        async function addVehicle() {
            try {
                const model = document.getElementById('vehicleModel').value;
                const plate = document.getElementById('vehiclePlate').value;
                const year = document.getElementById('vehicleYear').value;
                const km = document.getElementById('vehicleKm').value;
                const tankCapacity = document.getElementById('vehicleTankCapacity').value;
                
                if (!model || !plate || !year || !km || !tankCapacity) {
                    showNotification('Por favor, preencha todos os campos.');
                    return;
                }
                
                const newVehicle = {
                    id: generateId(),
                    type: selectedVehicleType,
                    model: model,
                    plate: plate.toUpperCase(),
                    year: year,
                    km: parseInt(km),
                    tankCapacity: parseInt(tankCapacity),
                    tankLevel: 100
                };
                
                vehicles.push(newVehicle);
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                
                // Salvar no Realtime Database
                await saveVehicleToDatabase(newVehicle);
                
                loadVehicles();
                selectVehicle(newVehicle.id);
                closeModal('addVehicleModal');
                showNotification('Ve√≠culo adicionado com sucesso!');
            } catch (error) {
                console.error('Erro ao adicionar ve√≠culo:', error);
                showNotification('Erro ao adicionar ve√≠culo.');
            }
        }
        
        // Fun√ß√£o para excluir ve√≠culo
        async function deleteVehicle(vehicleId) {
            if (!confirm('Tem certeza que deseja excluir este ve√≠culo? Todos os abastecimentos e manuten√ß√µes relacionados tamb√©m ser√£o exclu√≠dos.')) {
                return;
            }
            
            try {
                // Remover ve√≠culo
                vehicles = vehicles.filter(v => v.id !== vehicleId);
                
                // Remover abastecimentos relacionados
                refuels = refuels.filter(r => r.vehicleId !== vehicleId);
                
                // Remover manuten√ß√µes relacionadas
                maintenances = maintenances.filter(m => m.vehicleId !== vehicleId);
                
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                localStorage.setItem('refuels', JSON.stringify(refuels));
                localStorage.setItem('maintenances', JSON.stringify(maintenances));
                
                // Remover do Realtime Database
                if (currentUserId) {
                    await database.ref(`users/${currentUserId}/vehicles/${vehicleId}`).remove();
                    
                    // Remover abastecimentos relacionados
                    const refuelsSnapshot = await database.ref(`users/${currentUserId}/refuels`).once('value');
                    if (refuelsSnapshot.exists()) {
                        const refuelsData = refuelsSnapshot.val();
                        Object.keys(refuelsData).forEach(key => {
                            if (refuelsData[key].vehicleId === vehicleId) {
                                database.ref(`users/${currentUserId}/refuels/${key}`).remove();
                            }
                        });
                    }
                    
                    // Remover manuten√ß√µes relacionadas
                    const maintenancesSnapshot = await database.ref(`users/${currentUserId}/maintenances`).once('value');
                    if (maintenancesSnapshot.exists()) {
                        const maintenancesData = maintenancesSnapshot.val();
                        Object.keys(maintenancesData).forEach(key => {
                            if (maintenancesData[key].vehicleId === vehicleId) {
                                database.ref(`users/${currentUserId}/maintenances/${key}`).remove();
                            }
                        });
                    }
                }
                
                // Atualizar interface
                loadVehicles();
                loadRefuels();
                loadMaintenances();
                updateStatistics();
                
                if (currentVehicle && currentVehicle.id === vehicleId) {
                    currentVehicle = vehicles.length > 0 ? vehicles[0] : null;
                    updateDashboard();
                }
                
                showNotification('Ve√≠culo exclu√≠do com sucesso!');
            } catch (error) {
                console.error('Erro ao excluir ve√≠culo:', error);
                showNotification('Erro ao excluir ve√≠culo.');
            }
        }
        
        // Fun√ß√£o para selecionar ve√≠culo
        function selectVehicle(vehicleId) {
            currentVehicle = vehicles.find(v => v.id === vehicleId);
            updateDashboard();
        }
        
        // Fun√ß√£o para calcular a efici√™ncia do ve√≠culo (km/L)
        function calculateEfficiency(vehicleId) {
            try {
                const vehicleRefuels = refuels.filter(r => r.vehicleId === vehicleId)
                                             .sort((a, b) => new Date(a.date) - new Date(b.date));
                
                if (vehicleRefuels.length < 2) {
                    return null;
                }
                
                let totalKm = 0;
                let totalLiters = 0;
                
                for (let i = 1; i < vehicleRefuels.length; i++) {
                    const currentRefuel = vehicleRefuels[i];
                    const previousRefuel = vehicleRefuels[i - 1];
                    
                    if (previousRefuel.fullTank) {
                        const kmDriven = currentRefuel.km - previousRefuel.km;
                        const litersUsed = currentRefuel.liters;
                        
                        if (kmDriven > 0 && litersUsed > 0 && kmDriven < 5000) {
                            totalKm += kmDriven;
                            totalLiters += litersUsed;
                        }
                    }
                }
                
                if (totalLiters <= 0) return null;
                
                return totalKm / totalLiters;
            } catch (error) {
                console.error('Erro ao calcular efici√™ncia:', error);
                return null;
            }
        }
        
        // Fun√ß√£o para atualizar dashboard
        function updateDashboard() {
            try {
                if (!currentVehicle) {
                    document.getElementById('currentVehicleName').textContent = 'Selecione um ve√≠culo';
                    document.getElementById('currentVehicleDetails').textContent = 'Nenhum ve√≠culo cadastrado';
                    document.getElementById('currentEfficiency').textContent = '--';
                    document.getElementById('currentKm').textContent = '--';
                    document.getElementById('currentTankLevel').textContent = '--%';
                    document.getElementById('currentTankFill').style.width = '0%';
                    document.getElementById('autonomyInfo').textContent = 'Autonomia: -- km';
                    document.getElementById('lastRefuelItem').innerHTML = `
                        <div>
                            <div class="item-title">Nenhum abastecimento</div>
                            <div class="item-details">Registre seu primeiro abastecimento</div>
                        </div>
                        <div class="item-value">--</div>
                    `;
                    return;
                }
                
                const iconClass = currentVehicle.type === 'car' ? 'car' : 
                                 currentVehicle.type === 'motorcycle' ? 'motorcycle' : 'truck';
                
                document.getElementById('currentVehicleIcon').innerHTML = `<i class="fas fa-${iconClass}"></i>`;
                document.getElementById('currentVehicleName').textContent = currentVehicle.model;
                document.getElementById('currentVehicleDetails').textContent = `${currentVehicle.plate} ‚Ä¢ ${currentVehicle.year}`;
                document.getElementById('currentKm').textContent = currentVehicle.km.toLocaleString('pt-BR');
                
                const efficiency = calculateEfficiency(currentVehicle.id);
                
                if (efficiency) {
                    document.getElementById('currentEfficiency').textContent = efficiency.toFixed(1);
                    
                    const remainingLiters = (currentVehicle.tankLevel / 100) * currentVehicle.tankCapacity;
                    const autonomy = remainingLiters * efficiency;
                    document.getElementById('autonomyInfo').textContent = `Autonomia: ${autonomy.toFixed(0)} km`;
                    
                    updateConsumptionComparison(currentVehicle.id, efficiency);
                } else {
                    document.getElementById('currentEfficiency').textContent = '--';
                    document.getElementById('autonomyInfo').textContent = 'Autonomia: -- km';
                    document.getElementById('consumptionComparison').innerHTML = `
                        <span class="comparison-label">Vs. √∫ltimo m√™s</span>
                        <span class="comparison-value">--</span>
                    `;
                }
                
                document.getElementById('currentTankLevel').textContent = `${currentVehicle.tankLevel}%`;
                document.getElementById('currentTankFill').style.width = `${currentVehicle.tankLevel}%`;
                
                if (currentVehicle.tankLevel < 20) {
                    document.getElementById('currentTankFill').style.background = 'linear-gradient(to right, var(--danger), #d90429)';
                } else if (currentVehicle.tankLevel < 40) {
                    document.getElementById('currentTankFill').style.background = 'linear-gradient(to right, var(--warning), #f72585)';
                } else {
                    document.getElementById('currentTankFill').style.background = 'linear-gradient(to right, var(--primary), var(--secondary))';
                }
                
                const lastRefuel = refuels.filter(r => r.vehicleId === currentVehicle.id)
                                         .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                
                if (lastRefuel) {
                    document.getElementById('lastRefuelItem').innerHTML = `
                        <div>
                            <div class="item-title">${formatDate(lastRefuel.date)}</div>
                            <div class="item-details">${lastRefuel.station || 'Posto n√£o informado'} ‚Ä¢ ${lastRefuel.liters.toFixed(1)} L</div>
                        </div>
                        <div class="item-value">R$ ${lastRefuel.amount.toFixed(2)}</div>
                    `;
                } else {
                    document.getElementById('lastRefuelItem').innerHTML = `
                        <div>
                            <div class="item-title">Nenhum abastecimento</div>
                            <div class="item-details">Registre seu primeiro abastecimento</div>
                        </div>
                        <div class="item-value">--</div>
                    `;
                }
                
                initCharts();
                loadMaintenances();
            } catch (error) {
                console.error('Erro ao atualizar dashboard:', error);
            }
        }
        
        // Fun√ß√£o para atualizar compara√ß√£o de consumo
        function updateConsumptionComparison(vehicleId, currentEfficiency) {
            try {
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                
                let lastMonth = currentMonth - 1;
                let lastYear = currentYear;
                if (lastMonth < 0) {
                    lastMonth = 11;
                    lastYear = currentYear - 1;
                }
                
                const lastMonthRefuels = refuels.filter(refuel => {
                    const refuelDate = new Date(refuel.date);
                    return refuelDate.getMonth() === lastMonth && 
                           refuelDate.getFullYear() === lastYear &&
                           refuel.vehicleId === vehicleId;
                });
                
                let lastMonthEfficiency = null;
                if (lastMonthRefuels.length >= 2) {
                    lastMonthRefuels.sort((a, b) => new Date(a.date) - new Date(b.date));
                    let totalKm = 0;
                    let totalLiters = 0;
                    
                    for (let i = 1; i < lastMonthRefuels.length; i++) {
                        if (lastMonthRefuels[i-1].fullTank) {
                            const km = lastMonthRefuels[i].km - lastMonthRefuels[i-1].km;
                            const liters = lastMonthRefuels[i].liters;
                            if (km > 0 && liters > 0) {
                                totalKm += km;
                                totalLiters += liters;
                            }
                        }
                    }
                    
                    if (totalLiters > 0) {
                        lastMonthEfficiency = totalKm / totalLiters;
                    }
                }
                
                const comparisonElement = document.getElementById('consumptionComparison');
                if (lastMonthEfficiency && currentEfficiency) {
                    const difference = currentEfficiency - lastMonthEfficiency;
                    const percentage = (difference / lastMonthEfficiency) * 100;
                    
                    comparisonElement.innerHTML = `
                        <span class="comparison-label">Vs. √∫ltimo m√™s</span>
                        <span class="comparison-value ${difference >= 0 ? 'positive' : 'negative'}">
                            ${difference >= 0 ? '+' : ''}${percentage.toFixed(1)}%
                        </span>
                    `;
                } else {
                    comparisonElement.innerHTML = `
                        <span class="comparison-label">Vs. √∫ltimo m√™s</span>
                        <span class="comparison-value">--</span>
                    `;
                }
            } catch (error) {
                console.error('Erro ao calcular compara√ß√£o:', error);
            }
        }
        
        // Fun√ß√£o para adicionar abastecimento
        async function addRefuel() {
            try {
                const vehicleId = document.getElementById('refuelVehicle').value;
                const date = document.getElementById('refuelDate').value;
                const station = document.getElementById('refuelStation').value;
                const price = parseFloat(document.getElementById('refuelPrice').value);
                const amount = parseFloat(document.getElementById('refuelAmount').value);
                const liters = parseFloat(document.getElementById('refuelLiters').value);
                const km = parseInt(document.getElementById('refuelKm').value);
                const fullTank = document.getElementById('refuelFullTank').value === 'true';
                
                if (!vehicleId || !date || !price || !amount || !liters || !km) {
                    showNotification('Por favor, preencha todos os campos obrigat√≥rios.');
                    return;
                }
                
                const vehicle = vehicles.find(v => v.id === vehicleId);
                if (!vehicle) {
                    showNotification('Ve√≠culo n√£o encontrado.');
                    return;
                }
                
                if (km <= vehicle.km) {
                    showNotification('A quilometragem deve ser maior que a atual do ve√≠culo.');
                    return;
                }
                
                const newRefuel = {
                    id: generateId(),
                    vehicleId: vehicleId,
                    date: date,
                    station: station,
                    price: price,
                    amount: amount,
                    liters: liters,
                    km: km,
                    fullTank: fullTank
                };
                
                refuels.push(newRefuel);
                localStorage.setItem('refuels', JSON.stringify(refuels));
                
                vehicle.km = km;
                
                if (fullTank) {
                    vehicle.tankLevel = 100;
                } else {
                    const litersToAdd = liters;
                    const tankCapacity = vehicle.tankCapacity;
                    const currentLiters = (vehicle.tankLevel / 100) * tankCapacity;
                    const newLiters = Math.min(currentLiters + litersToAdd, tankCapacity);
                    vehicle.tankLevel = Math.round((newLiters / tankCapacity) * 100);
                }
                
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                
                // Salvar no Realtime Database
                await saveRefuelToDatabase(newRefuel);
                await saveVehicleToDatabase(vehicle);
                
                if (currentVehicle && currentVehicle.id === vehicleId) {
                    updateDashboard();
                }
                
                loadRefuels();
                updateStatistics();
                
                document.getElementById('refuelStation').value = '';
                document.getElementById('refuelAmount').value = '';
                document.getElementById('refuelLiters').value = '';
                document.getElementById('refuelKm').value = '';
                document.getElementById('refuelFullTank').value = 'true';
                
                showNotification('Abastecimento registrado com sucesso!');
            } catch (error) {
                console.error('Erro ao adicionar abastecimento:', error);
                showNotification('Erro ao registrar abastecimento.');
            }
        }
        
        // Fun√ß√£o para adicionar manuten√ß√£o
        async function addMaintenance() {
            try {
                const vehicleId = document.getElementById('maintenanceVehicle').value;
                const name = document.getElementById('maintenanceName').value;
                const description = document.getElementById('maintenanceDescription').value;
                const date = document.getElementById('maintenanceDate').value;
                const km = parseInt(document.getElementById('maintenanceKm').value);
                const repeatKm = parseInt(document.getElementById('maintenanceRepeatKm').value);
                const completed = document.getElementById('maintenanceCompleted').checked;
                
                if (!vehicleId || !name || !date || !km || !repeatKm) {
                    showNotification('Por favor, preencha todos os campos obrigat√≥rios.');
                    return;
                }
                
                const vehicle = vehicles.find(v => v.id === vehicleId);
                if (!vehicle) {
                    showNotification('Ve√≠culo n√£o encontrado.');
                    return;
                }
                
                const newMaintenance = {
                    id: generateId(),
                    vehicleId: vehicleId,
                    name: name,
                    description: description,
                    date: date,
                    lastKm: km,
                    repeatKm: repeatKm,
                    completed: completed
                };
                
                maintenances.push(newMaintenance);
                localStorage.setItem('maintenances', JSON.stringify(maintenances));
                
                // Salvar no Realtime Database
                await saveMaintenanceToDatabase(newMaintenance);
                
                document.getElementById('maintenanceName').value = '';
                document.getElementById('maintenanceDescription').value = '';
                document.getElementById('maintenanceKm').value = '';
                document.getElementById('maintenanceRepeatKm').value = '';
                document.getElementById('maintenanceCompleted').checked = false;
                
                loadMaintenances();
                
                if (currentVehicle && currentVehicle.id === vehicleId) {
                    updateDashboard();
                }
                
                showNotification('Manuten√ß√£o registrada com sucesso!');
            } catch (error) {
                console.error('Erro ao adicionar manuten√ß√£o:', error);
                showNotification('Erro ao registrar manuten√ß√£o.');
            }
        }
        
        // Fun√ß√£o para editar manuten√ß√£o
        function editMaintenance(maintenanceId) {
            try {
                const maintenance = maintenances.find(m => m.id === maintenanceId);
                if (!maintenance) return;
                
                editingMaintenanceId = maintenanceId;
                
                document.getElementById('editMaintenanceName').value = maintenance.name;
                document.getElementById('editMaintenanceDescription').value = maintenance.description || '';
                document.getElementById('editMaintenanceDate').value = maintenance.date;
                document.getElementById('editMaintenanceKm').value = maintenance.lastKm;
                document.getElementById('editMaintenanceRepeatKm').value = maintenance.repeatKm;
                document.getElementById('editMaintenanceCompleted').checked = maintenance.completed;
                
                openModal('editMaintenanceModal');
            } catch (error) {
                console.error('Erro ao editar manuten√ß√£o:', error);
                showNotification('Erro ao carregar manuten√ß√£o.');
            }
        }
        
        // Fun√ß√£o para salvar manuten√ß√£o editada
        async function saveEditedMaintenance() {
            try {
                if (!editingMaintenanceId) return;
                
                const maintenanceIndex = maintenances.findIndex(m => m.id === editingMaintenanceId);
                if (maintenanceIndex === -1) return;
                
                maintenances[maintenanceIndex].name = document.getElementById('editMaintenanceName').value;
                maintenances[maintenanceIndex].description = document.getElementById('editMaintenanceDescription').value;
                maintenances[maintenanceIndex].date = document.getElementById('editMaintenanceDate').value;
                maintenances[maintenanceIndex].lastKm = parseInt(document.getElementById('editMaintenanceKm').value);
                maintenances[maintenanceIndex].repeatKm = parseInt(document.getElementById('editMaintenanceRepeatKm').value);
                maintenances[maintenanceIndex].completed = document.getElementById('editMaintenanceCompleted').checked;
                
                localStorage.setItem('maintenances', JSON.stringify(maintenances));
                
                // Atualizar no Realtime Database
                await saveMaintenanceToDatabase(maintenances[maintenanceIndex]);
                
                loadMaintenances();
                closeModal('editMaintenanceModal');
                showNotification('Manuten√ß√£o atualizada com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar manuten√ß√£o:', error);
                showNotification('Erro ao salvar manuten√ß√£o.');
            }
        }
        
        // Fun√ß√£o para excluir manuten√ß√£o
        async function deleteMaintenance() {
            try {
                if (!editingMaintenanceId || !confirm('Tem certeza que deseja excluir esta manuten√ß√£o?')) {
                    return;
                }
                
                maintenances = maintenances.filter(m => m.id !== editingMaintenanceId);
                localStorage.setItem('maintenances', JSON.stringify(maintenances));
                
                // Remover do Realtime Database
                if (currentUserId) {
                    await database.ref(`users/${currentUserId}/maintenances/${editingMaintenanceId}`).remove();
                }
                
                loadMaintenances();
                closeModal('editMaintenanceModal');
                showNotification('Manuten√ß√£o exclu√≠da com sucesso!');
            } catch (error) {
                console.error('Erro ao excluir manuten√ß√£o:', error);
                showNotification('Erro ao excluir manuten√ß√£o.');
            }
        }
        
        // Fun√ß√£o para calcular litros com base no pre√ßo e valor total
        function calculateLiters() {
            try {
                const price = parseFloat(document.getElementById('refuelPrice').value);
                const amount = parseFloat(document.getElementById('refuelAmount').value);
                
                if (price && amount && price > 0) {
                    const liters = amount / price;
                    document.getElementById('refuelLiters').value = liters.toFixed(2);
                } else {
                    document.getElementById('refuelLiters').value = '';
                }
            } catch (error) {
                console.error('Erro ao calcular litros:', error);
            }
        }
        
        // Fun√ß√£o para atualizar estat√≠sticas
        function updateStatistics() {
            try {
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                
                const monthlyRefuels = refuels.filter(refuel => {
                    const refuelDate = new Date(refuel.date);
                    return refuelDate.getMonth() === currentMonth && refuelDate.getFullYear() === currentYear;
                });
                
                const monthlyExpense = monthlyRefuels.reduce((total, refuel) => total + refuel.amount, 0);
                document.getElementById('monthlyExpense').textContent = `R$ ${monthlyExpense.toFixed(2)}`;
                
                let monthlyKm = 0;
                if (monthlyRefuels.length > 0) {
                    const firstRefuel = monthlyRefuels.reduce((earliest, refuel) => {
                        return new Date(refuel.date) < new Date(earliest.date) ? refuel : earliest;
                    }, monthlyRefuels[0]);
                    
                    const lastRefuel = monthlyRefuels.reduce((latest, refuel) => {
                        return new Date(refuel.date) > new Date(latest.date) ? refuel : latest;
                    }, monthlyRefuels[0]);
                    
                    monthlyKm = lastRefuel.km - firstRefuel.km;
                }
                document.getElementById('monthlyKm').textContent = `${monthlyKm.toLocaleString('pt-BR')} km`;
                
                const costPerKm = monthlyKm > 0 ? monthlyExpense / monthlyKm : 0;
                document.getElementById('costPerKm').textContent = `R$ ${costPerKm.toFixed(2)}`;
            } catch (error) {
                console.error('Erro ao atualizar estat√≠sticas:', error);
            }
        }
        
        // Fun√ß√£o para inicializar gr√°ficos
        function initCharts() {
            try {
                if (!currentVehicle) return;
                
                const ctx = document.getElementById('consumptionChart').getContext('2d');
                
                const vehicleRefuels = refuels.filter(r => r.vehicleId === currentVehicle.id)
                                             .sort((a, b) => new Date(a.date) - new Date(b.date));
                
                const labels = [];
                const data = [];
                
                for (let i = 1; i < vehicleRefuels.length; i++) {
                    const current = vehicleRefuels[i];
                    const previous = vehicleRefuels[i - 1];
                    
                    if (previous.fullTank) {
                        const kmDriven = current.km - previous.km;
                        const litersUsed = current.liters;
                        
                        if (litersUsed > 0 && kmDriven > 0 && kmDriven < 5000) {
                            const efficiency = kmDriven / litersUsed;
                            
                            const date = new Date(current.date);
                            const month = date.getMonth() + 1;
                            const year = date.getFullYear().toString().slice(-2);
                            
                            labels.push(`${month}/${year}`);
                            data.push(efficiency);
                        }
                    }
                }
                
                if (data.length < 1) {
                    document.getElementById('consumptionChart').innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #8d99ae;">
                            <i class="fas fa-chart-line" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>Dados insuficientes para exibir o gr√°fico</p>
                            <p style="font-size: 0.8rem;">Registre mais abastecimentos</p>
                        </div>
                    `;
                    return;
                }
                
                if (window.consumptionChartInstance) {
                    window.consumptionChartInstance.destroy();
                }
                
                window.consumptionChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'km/L',
                            data: data,
                            borderColor: '#4361ee',
                            backgroundColor: 'rgba(67, 97, 238, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        return `Consumo: ${context.raw.toFixed(1)} km/L`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                grid: {
                                    drawBorder: false
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Erro ao inicializar gr√°ficos:', error);
            }
        }
        
        // Fun√ß√£o para mostrar modal de atualiza√ß√£o de KM
        function showUpdateKmModal() {
            try {
                if (!currentVehicle) {
                    showNotification('Selecione um ve√≠culo primeiro.');
                    return;
                }
                
                document.getElementById('updateKmVehicleName').textContent = currentVehicle.model;
                document.getElementById('updateKmValue').value = currentVehicle.km;
                document.getElementById('previousKm').textContent = currentVehicle.km.toLocaleString('pt-BR');
                document.getElementById('currentTankBeforeUpdate').textContent = `${currentVehicle.tankLevel}%`;
                
                const updateKmInput = document.getElementById('updateKmValue');
                updateKmInput.removeEventListener('input', updateKmEstimate);
                updateKmInput.addEventListener('input', updateKmEstimate);
                updateKmEstimate();
                
                openModal('updateKmModal');
            } catch (error) {
                console.error('Erro ao mostrar modal de KM:', error);
                showNotification('Erro ao carregar dados.');
            }
        }
        
        // Fun√ß√£o para atualizar estimativa de KM
        function updateKmEstimate() {
            try {
                const newKm = parseInt(document.getElementById('updateKmValue').value) || currentVehicle.km;
                const kmDriven = newKm - currentVehicle.km;
                document.getElementById('kmDriven').textContent = `${kmDriven.toLocaleString('pt-BR')} km`;
                
                const efficiency = calculateEfficiency(currentVehicle.id) || 10;
                const litersUsed = kmDriven / efficiency;
                const currentLiters = (currentVehicle.tankLevel / 100) * currentVehicle.tankCapacity;
                const newLiters = Math.max(0, currentLiters - litersUsed);
                const newTankLevel = Math.round((newLiters / currentVehicle.tankCapacity) * 100);
                
                document.getElementById('estimatedTankAfterUpdate').textContent = `${newTankLevel}%`;
            } catch (error) {
                console.error('Erro ao atualizar estimativa:', error);
            }
        }
        
        // Fun√ß√£o para atualizar quilometragem
        async function updateKm() {
            try {
                if (!currentVehicle) return;
                
                const newKm = parseInt(document.getElementById('updateKmValue').value);
                
                if (!newKm || newKm <= currentVehicle.km) {
                    showNotification('A quilometragem deve ser maior que a atual.');
                    return;
                }
                
                const kmDriven = newKm - currentVehicle.km;
                const efficiency = calculateEfficiency(currentVehicle.id) || 10;
                const litersConsumed = kmDriven / efficiency;
                const tankCapacity = currentVehicle.tankCapacity;
                const currentLiters = (currentVehicle.tankLevel / 100) * tankCapacity;
                const newLiters = Math.max(0, currentLiters - litersConsumed);
                currentVehicle.tankLevel = Math.round((newLiters / tankCapacity) * 100);
                currentVehicle.km = newKm;
                
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                
                // Atualizar no Realtime Database
                await saveVehicleToDatabase(currentVehicle);
                
                updateDashboard();
                loadMaintenances();
                closeModal('updateKmModal');
                showNotification('Quilometragem atualizada com sucesso!');
            } catch (error) {
                console.error('Erro ao atualizar KM:', error);
                showNotification('Erro ao atualizar quilometragem.');
            }
        }
        
        // Fun√ß√µes para gerenciar pre√ßo da gasolina
        function showFuelPriceModal() {
            document.getElementById('newFuelPrice').value = settings.fuelPrice;
            openModal('fuelPriceModal');
        }
        
        async function updateFuelPrice() {
            try {
                const newPrice = parseFloat(document.getElementById('newFuelPrice').value);
                
                if (!newPrice || newPrice <= 0) {
                    showNotification('Digite um pre√ßo v√°lido.');
                    return;
                }
                
                settings.fuelPrice = newPrice;
                
                if (currentUserId) {
                    await database.ref(`users/${currentUserId}/settings`).set(settings);
                }
                
                localStorage.setItem('fuelmanager_settings', JSON.stringify(settings));
                
                document.getElementById('refuelPrice').value = newPrice;
                document.getElementById('currentFuelPrice').textContent = `R$ ${newPrice.toFixed(2)}/L`;
                
                closeModal('fuelPriceModal');
                showNotification('Pre√ßo da gasolina atualizado!');
            } catch (error) {
                console.error('Erro ao atualizar pre√ßo:', error);
                showNotification('Erro ao atualizar pre√ßo.');
            }
        }
        
        // Fun√ß√µes auxiliares
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('pt-BR');
            } catch (error) {
                return dateString;
            }
        }
        
        function showTab(tabId) {
            try {
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                document.getElementById(tabId).classList.add('active');
                
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const navItems = document.querySelectorAll('.nav-item');
                navItems.forEach((item, index) => {
                    if (index === 0 && tabId === 'dashboard') item.classList.add('active');
                    if (index === 1 && tabId === 'veiculos') item.classList.add('active');
                    if (index === 2 && tabId === 'abastecimento') item.classList.add('active');
                    if (index === 3 && tabId === 'manutencoes') item.classList.add('active');
                });
                
                if (tabId === 'veiculos' || tabId === 'manutencoes') {
                    updateStatistics();
                }
            } catch (error) {
                console.error('Erro ao mudar tab:', error);
            }
        }
        
        function showAddVehicleModal() {
            openModal('addVehicleModal');
        }
        
        function showSettings() {
            openModal('settingsModal');
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function selectVehicleType(type) {
            selectedVehicleType = type;
            
            document.querySelectorAll('.vehicle-type').forEach(el => {
                el.classList.remove('active');
            });
            
            document.querySelector(`.vehicle-type[data-type="${type}"]`).classList.add('active');
        }
        
        function showNotification(message) {
            try {
                const notification = document.getElementById('notification');
                const notificationText = document.getElementById('notificationText');
                
                notificationText.textContent = message;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            } catch (error) {
                console.error('Erro ao mostrar notifica√ß√£o:', error);
            }
        }
        
        function toggleNotifications() {
            showNotification('N√£o h√° novas notifica√ß√µes.');
        }
        
        // Teste de conex√£o com Firebase
        async function testConnection() {
            try {
                console.log('üîç Testando conex√£o com Firebase Realtime Database...');
                
                const testRef = database.ref('testConnection');
                await testRef.set({
                    timestamp: Date.now(),
                    message: 'Teste de conex√£o do FuelManager'
                });
                
                console.log('‚úÖ Conex√£o com Firebase estabelecida!');
                return true;
            } catch (error) {
                console.error('‚ùå Erro na conex√£o com Firebase:', error);
                return false;
            }
        }
    </script>
</body>
</html>
